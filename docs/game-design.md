# 電脳将棋CTF - ダークウェブコントロール 設計ドキュメント

## 1. ゲームコンセプト

### 1.1 概要
「電脳将棋CTF - ダークウェブコントロール」は、プレイヤーがAIオペレーターとなり、チャットコマンドでBOT群を指揮してサーバーネットワークを制圧するリアルタイム戦略ゲームです。

### 1.2 コアメカニクス
- **間接操作**: プレイヤーは直接操作せず、チャットでBOTに指示を送る
- **リソース管理**: サーバー制圧で得たマシンパワーでBOT数を増減
- **リアルタイム性**: ターン制ではなく、連続的に行動が実行される
- **CTF要素**: 敵のフラグ奪取が最終目標

## 2. ゲームルール

### 2.1 勝利条件
- 敵陣営のフラグが設置されたサーバーを制圧する

### 2.2 敗北条件
- 自陣営のフラグが奪われる
- 全BOTが削除され、かつ新BOT作成に必要なマシンパワーが不足

### 2.3 マシンパワーシステム
```
初期マシンパワー: 100
最大マシンパワー: 100 + (制御サーバー数 × 50)
BOT作成コスト: 30
BOT削除時回収: 15（作成コストの50%）
サーバー制圧報酬: +50
```

### 2.4 BOTアクション
| アクション | 説明 | 実行時間 | クールダウン |
|----------|------|---------|------------|
| 移動 | 指定座標へ移動 | 距離依存 | なし |
| スキャン | 隣接4マスの情報取得 | 2秒 | 3秒 |
| 侵入 | サーバー制圧を試みる | 5秒 | 5秒 |
| 防御 | 防御レベルを+1（最大3） | 3秒 | 4秒 |
| 複製 | 隣接マスに新BOT作成 | 4秒 | 6秒 |
| 偽装 | 偽フラグを設置 | 2.5秒 | 8秒 |

### 2.5 サーバー属性
```javascript
{
  owner: null | 'player' | 'enemy',  // 所有者
  defenseLevel: 0-3,                  // 防御レベル
  hasFlag: boolean,                   // 真のフラグ
  hasFakeFlag: boolean,               // 偽フラグ
  isScanned: boolean                  // スキャン済みフラグ
}
```

### 2.6 侵入成功率
```
基本成功率 = 0.8 - (防御レベル × 0.2)
例: 防御レベル0 → 80%、防御レベル3 → 20%
```

## 3. UI仕様

### 3.1 レイアウト
```
+----------------------------------+
|  ゲーム画面 (800x600)            |
|  +----------------------------+  |
|  |  9×9グリッド              |  |
|  |  サーバーノード表示        |  |
|  +----------------------------+  |
|                                  |
|  ステータスパネル（右上）         |
+----------------------------------+
|  チャット画面 (800x150)          |
|  +----------------------------+  |
|  | チャットログ               |  |
|  +----------------------------+  |
|  | 入力欄          | 送信     |  |
|  +----------------------------+  |
+----------------------------------+
```

### 3.2 ビジュアル仕様

#### カラーパレット
```css
背景: #0a0a0a (ほぼ黒)
グリッド線: #00ff00 (ライム, opacity: 0.3)
プレイヤー色: #00ffff (シアン)
敵色: #ff00ff (マゼンタ)
システム色: #ffff00 (黄色)
エラー色: #ff0000 (赤)
```

#### サーバーノード
- 基本: 半径20pxの円、枠線2px
- 未制御: 塗り#003300（暗緑）
- プレイヤー制御: 塗り#004400（緑）
- 敵制御: 塗り#440044（紫）
- 防御レベル: 枠線の太さ = 2 + 防御レベル

#### BOT表示
- 半径10pxの円
- プレイヤー: #00ff00（緑）、白枠
- 敵: #ff0000（赤）、マゼンタ枠
- 名前表示: BOTの上部に表示

### 3.3 ステータスパネル
```
ダークウェブコントロール
マシンパワー: [現在値] / [最大値]
[======== プログレスバー ========]
活動中BOT: [数]
制御サーバー: [数]
------------------------
BOT一覧
Bot1 - (x,y) - 状態/CD
Bot2 - (x,y) - 状態/CD
...
```

## 4. チャットコマンド仕様

### 4.1 コマンド形式
```
bot[番号][アクション][パラメータ]
```

### 4.2 コマンド一覧
| コマンド | 例 | 説明 |
|---------|-----|------|
| 移動 | `bot1を(4,5)に移動` | 指定座標へ移動 |
| スキャン | `bot2でスキャン` | 周囲4マスを探査 |
| 侵入 | `bot3で侵入` | 現在のサーバーを制圧 |
| 防御 | `bot4で防御` | 防御レベル強化 |
| 複製 | `bot5で複製` | 隣接マスに新BOT |
| 偽装 | `bot6で偽装` | 偽フラグ設置 |
| 作成 | `新しいbotを作成` | 新規BOT作成 |
| 削除 | `bot7を削除` | BOT削除（パワー回収） |
| 状態 | `bot8の状態` | BOT情報表示 |
| ヘルプ | `ヘルプ` | コマンド一覧表示 |

### 4.3 チャットメッセージ形式
```
[時刻] [種別] メッセージ
種別: [SYSTEM] [YOU] [AI] [ENEMY] [ERROR]
```

## 5. ゲームフロー

### 5.1 初期配置
1. 9×9グリッドを生成
2. プレイヤーフラグを下側3行のランダム位置に配置
3. 敵フラグを上側3行のランダム位置に配置
4. 各陣営に3体のBOTを初期配置
5. フラグサーバーは自動的に所有権を持つ

### 5.2 ゲームループ
```javascript
// 毎フレーム
1. BOT状態更新
   - クールダウン減少
   - アクション進行
   - 移動処理
   
2. 敵AI処理（5秒ごと）
   - 各敵BOTの行動決定
   - 移動/侵入の実行
   
3. UI更新
   - BOTリスト更新（0.5秒ごと）
   - マシンパワー表示
   - サーバービジュアル更新
   
4. 勝利条件チェック
```

### 5.3 敵AI戦略
```javascript
// 5秒ごとに各敵BOTが行動
行動確率:
- 40%: プレイヤーサーバーへ移動
- 30%: ランダム移動
- 15%: 現在地で侵入試行
- 15%: 待機
```

## 6. エフェクト仕様

### 6.1 アクションエフェクト
- **基本**: 半径15pxの半透明円が2倍に拡大しながらフェードアウト（1秒）
- **色**: アクションタイプに応じた色
  - スキャン: #00ff00（緑）
  - 侵入: #ff0000（赤）
  - 防御: #0000ff（青）
  - 複製: #ff00ff（マゼンタ）
  - 偽装: #ffff00（黄）

### 6.2 スキャンライン
- 始点から終点への直線
- 色: #00ff00（緑）
- 1秒かけてフェードアウト

### 6.3 BOT作成エフェクト
- 中心から8方向に小さな円が飛散
- 各粒子は30px移動しながらフェードアウト（0.8秒）

## 7. 実装技術仕様

### 7.1 使用技術
- **ゲームエンジン**: Phaser 3.70.0
- **言語**: JavaScript (ES6+)
- **スタイル**: インラインCSS

### 7.2 主要クラス構造
```javascript
class CommandInterpreter {
  // チャットコマンドを解析してゲームアクションに変換
}

class Server {
  // サーバーの状態管理
}

class Bot {
  // BOTの状態と行動管理
  update(delta, scene) // 毎フレーム更新
}

class GameScene extends Phaser.Scene {
  // メインゲームロジック
  create() // 初期化
  update(time, delta) // ゲームループ
}
```

### 7.3 座標系
- グリッド座標: 0-8 (x, y)
- ピクセル座標: グリッド座標 × 60 + オフセット

## 8. バランス調整パラメータ

これらの値を調整することでゲームバランスを変更可能：

```javascript
const GRID_SIZE = 9;          // グリッドサイズ
const BOT_COST = 30;          // BOT作成コスト
const SERVER_POWER = 50;      // サーバー制圧報酬
const BOT_SPEED = 120;        // BOT移動速度（px/秒）

// アクション時間（ミリ秒）
const SCAN_TIME = 2000;
const HACK_TIME = 5000;
const DEFEND_TIME = 3000;
const REPLICATE_TIME = 4000;
const DECOY_TIME = 2500;

// クールダウン（ミリ秒）
const SCAN_COOLDOWN = 3000;
const HACK_COOLDOWN = 5000;
const DEFEND_COOLDOWN = 4000;
const REPLICATE_COOLDOWN = 6000;
const DECOY_COOLDOWN = 8000;

// 成功率
const BASE_HACK_RATE = 0.8;
const DEFENSE_REDUCTION = 0.2;
```
